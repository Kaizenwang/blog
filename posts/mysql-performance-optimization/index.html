<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>MySQL 性能优化 | 大头的博客</title><meta property="og:title" content="MySQL 性能优化 - 大头的博客"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-11-08T19:03:37+08:00"><meta property="article:modified_time" content="2022-11-08T19:03:37+08:00"><meta name=Keywords content="Java,MySQL,Spring,SpringBoot,SpringCloud"><meta name=description content="MySQL 性能优化"><meta name=author content="BigHead"><meta property="og:url" content="https://kaizen.wang/posts/mysql-performance-optimization/"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://kaizen.wang/>大头的博客</a></div><div><nav id=nav-menu class=clearfix><a class=current href=https://kaizen.wang/>首页</a>
<a href=https://kaizen.wang/archives/ title=归档>归档</a>
<a href=https://kaizen.wang/about/ title=关于>关于</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MySQL 性能优化</h1></header><time datetime=2022-11-08T11:03:37Z class="post-meta meta-date dt-published">2022年11月8日</time><div class=post-content><h2 id=避免使用短连接访问-mysql>避免使用短连接访问 MySQL</h2><p>短连接在业务高峰可能导致连接数暴涨，当连接数超过设置的 max_connections 时，会导致后续的请求被拒绝。虽然可以修改 max_connections 让更多的请求进来，但是如果设置的太大可能导致没有多余的 CPU 资源去执行 SQL，CPU 一直忙着建立连接。</p><p>方法一：主动断开连接。</p><p>方法二：减少连接过程的消耗，让 MySQL 跳过权限校验。</p><h2 id=慢查询性能问题>慢查询性能问题</h2><h3 id=索引没有创建好>索引没有创建好</h3><p>如果 MySQL 进程已经被打挂了，直接执行 alter table 就可以了。</p><p>如果服务还没有被打挂，并且是主备架构，可以考虑在备库上执行 alter table，在执行 alter table 前先关闭备库的 binlog，索引创建好后执行主备切换，然后在原来的主库上执行 alter table 创建索引，执行前也需要关闭 binlog。</p><h3 id=sql-语句没有写好>SQL 语句没有写好</h3><p>如果使用的是 MySQL 5.7 的版本，可以通过 query_rewrite 来重写有问题的 SQL。</p><h3 id=mysql-选错了索引>MySQL 选错了索引</h3><p>这里也可以通过 query_rewrite 来重写 SQL，让 SQL 可以使用正确的索引。</p><p>不过这个问题尽量在测试环境去提前发现，避免到生产环境，可以通过把 long_query_time 设置为 0，让所有的 SQL 被慢查询日志记录，然后关注慢查询日志中的 rows_examind（为了返回查询的数据，读取了多少行数）。</p><h2 id=qps-突增问题>QPS 突增问题</h2><p>如果是新功能引入的问题，考虑下掉新功能，保障其它功能可以正常使用。</p><p>如果是新功能的 SQL 有问题，可以考虑使用 query_rewrite 把有问题的 SQL 重写掉。</p><p>如果是某个库的问题，并且使用的独立的账号，可以考虑禁用掉该账号。</p><p>如果有设置白名单 ，也可以删除白名单。</p></div><div class=post-archive><h2>相关文章</h2><ul class=listing><li><a href=/about/>关于</a></li><li><a href=/archives/>归档</a></li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a href=/tags/mysql target=_blank>MySQL</a></li></ul></div></article><div class="post bg-white"><script src=https://giscus.app/client.js data-repo=kaizenwang/blog data-repo-id=R_kgDOIZQC7g data-category=Announcements data-category-id=DIC_kwDOIZQC7s4CSffN data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div><footer id=footer><div>&copy; 2022 <a href=https://kaizen.wang/>大头的博客 By BigHead</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[["$","$"]],processEscapes:!0}}</script><script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src='/js/totop.js?v=0.0.0' async></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-136328493-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><style type=text/css>div.highlight{position:relative;margin:1em 0}.copy-code{display:none;position:absolute;top:4px;right:4px;color:rgba(255,255,255,.8);background:rgba(78,78,78,.8);border-radius:var(--radius);padding:0 5px;font:inherit;user-select:none;cursor:pointer;border:0;--radius:8px}div.highlight:hover .copy-code,pre:hover .copy-code{display:block}</style><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://kaizen.wang/>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list><li><a href=https://kaizen.wang/posts/mysql-performance-optimization/ title="MySQL 性能优化" target=_blank>MySQL 性能优化</a></li></ul></section><section class=widget><h3 class=widget-title><a href=/categories/>分类</a></h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title><a href=/tags/>标签</a></h3><div class=tagcloud><a href=https://kaizen.wang/tags/mysql/>MySQL</a></div></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://kaizen.wang/index.xml>文章 RSS</a></li></ul></section></div></div></div></div></body></html>